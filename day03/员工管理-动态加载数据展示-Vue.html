<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>员工信息管理</title>
    <!-- CSS外部样式 -->
    <link rel="stylesheet" href="css/emp.css" />
  </head>
  <body>
    <!-- div 是一个没有语义的标签, 主要用于配合CSS布局 -->
    <div class="container" id="app">
      <div class="title">员工信息管理</div>
      <form class="search-bar" action="/api" method="get">
        <label for="name">姓 名：</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="请输入姓名"
          v-model="name"
        />

        <label for="gender">性 别：</label>
        <select id="gender" name="gender" v-model="gender">
          <option value="">请选择</option>
          <option value="1">男</option>
          <option value="2">女</option>
        </select>

        <label for="job">职 位：</label>
        <select id="job" name="job" v-model="job">
          <option value="">请选择</option>
          <option value="1">班主任</option>
          <option value="2">讲师</option>
          <option value="3">学工主管</option>
          <option value="4">教研主管</option>
          <option value="5">咨询师</option>
        </select>

        <button type="button" class="search-btn" @click="search">查询</button>
        <button type="button" class="clear-btn" @click="clear">清空</button>
      </form>

      <!-- 表格 -->
      <table>
        <!-- 表头 -->
        <thead>
          <tr>
            <th>序号</th>
            <th>姓名</th>
            <th>头像</th>
            <th>性别</th>
            <th>职位</th>
            <th>入职日期</th>
            <th>更新时间</th>
          </tr>
        </thead>

        <!-- 主体 -->
        <tbody id="tbody" ref="tbodyRef">
          <tr v-for="(item, index) in tableData" :key="item.id">
            <td>{{index + 1}}</td>
            <td>{{item.name}}</td>
            <td>
              <img
                :src="item.image"
                alt="{{item.name}}"
                width="30px"
                height="30px"
              />
            </td>
            <td>{{item.gender === 1 ? "男" : "女"}}</td>
            <td>{{jobMap[item.job]}}</td>
            <td>{{item.entrydate}}</td>
            <td>{{item.updatetime}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="module">
      import {
        createApp,
        ref,
        onMounted,
        useTemplateRef,
      } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";

      createApp({
        // data() {
        //   return {
        //     msg: "hello vue",
        //     name: "",
        //     gender: "",
        //     job: "",
        //   };
        // },
        setup() {
          const jobMap = {
            1: "班主任",
            2: "讲师",
            3: "学工主管",
            4: "教研主管",
            5: "咨询师",
          };
          const tbodyRef = useTemplateRef("tbodyRef");
          const name = ref("");
          const gender = ref("");
          const job = ref("");
          const tableData = ref([]);

          const search = async () => {
            const res = await axios.get(
              `https://web-server.itheima.net/emps/list?name=${name.value}&gender=${gender.value}&job=${job.value}`
            );
            tableData.value = res.data.data;
          };

          const clear = () => {
            name.value = "";
            gender.value = "";
            job.value = "";
            search();
          };

          onMounted(() => {
            search();
          });

          return {
            jobMap,
            name,
            gender,
            job,
            tableData,
            search,
            clear,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
