<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>员工信息管理</title>
    <!-- CSS外部样式 -->
    <link rel="stylesheet" href="css/emp.css" />
  </head>
  <body>
    <!-- div 是一个没有语义的标签, 主要用于配合CSS布局 -->
    <div class="container">
      <div class="title">员工信息管理</div>
      <form class="search-bar" action="/api" method="get">
        <label for="name">姓 名：</label>
        <input type="text" id="name" name="name" placeholder="请输入姓名" />

        <label for="gender">性 别：</label>
        <select id="gender" name="gender">
          <option value="">请选择</option>
          <option value="1">男</option>
          <option value="2">女</option>
        </select>

        <label for="job">职 位：</label>
        <select id="job" name="job">
          <option value="">请选择</option>
          <option value="1">班主任</option>
          <option value="2">讲师</option>
          <option value="3">学工主管</option>
          <option value="4">教研主管</option>
          <option value="5">咨询师</option>
        </select>

        <button type="button" class="search-btn">查询</button>
        <button type="button" class="clear-btn">清空</button>
      </form>

      <!-- 表格 -->
      <table>
        <!-- 表头 -->
        <thead>
          <tr>
            <th>序号</th>
            <th>姓名</th>
            <th>头像</th>
            <th>性别</th>
            <th>职位</th>
            <th>入职日期</th>
            <th>更新时间</th>
          </tr>
        </thead>

        <!-- 主体 -->
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      //1. 在点击 查询 按钮时, 获取搜索栏中输入的姓名、性别、职位，然后将其输出到控制台 （使用JS新语法）
      //1.1 DOM操作、事件监听
      document.querySelector(".search-btn").addEventListener("click", () => {
        let name = document.querySelector("#name").value;
        let gender = document.querySelector("#gender").value;
        let job = document.querySelector("#job").value;

        //2. 发送请求获取数据 https://web-server.itheima.net/emps/list?name=&gender=&job=
        query(name, gender, job);
      });

      // `` 引起来的字符串(模板字符串) -- 可以换行, 可以字符串拼接
      function query(name, gender, job) {
        let tbody = document.querySelector("#tbody");
        tbody.innerHTML = "";

        axios
          .get(
            `https://web-server.itheima.net/emps/list?name=${name}&gender=${gender}&job=${job}`
          )
          .then((result) => {
            let empList = result.data.data;
            //3. 遍历empList, 将数据展示到表格中
            empList.forEach((item) => {
              tbody.innerHTML += `
                        <tr>
                          <td>${item.id}</td>
                          <td>${item.name}</td>
                          <td><img src="${
                            item.image
                          }" alt="头像" class="avatar"></td>
                          <td>${item.gender == 1 ? "男" : "女"}</td>
                          <td>${
                            item.job == 1
                              ? "班主任"
                              : item.job == 2
                              ? "讲师"
                              : item.job == 3
                              ? "学工主管"
                              : item.job == 4
                              ? "教研主管"
                              : "咨询师"
                          }</td>
                          <td>${item.entrydate}</td>
                          <td>${item.updatetime}</td>
                        </tr>`;
            });
          });
      }

      //2. 点击 清空 按钮时, 清空搜索栏中的内容（使用JS新语法）
      document.querySelector(".clear-btn").addEventListener("click", () => {
        document.querySelector("#name").value = "";
        document.querySelector("#gender").value = "";
        document.querySelector("#job").value = "";

        //查询
        query("", "", "");
      });

      //3. 页面加载完成后, 发送请求获取数据
      query("", "", "");
    </script>
  </body>
</html>
