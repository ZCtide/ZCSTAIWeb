<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>课程信息管理系统</title>
    <style>
      body {
        font-family: "Microsoft YaHei", Arial, sans-serif;
        background: #fff;
        margin: 0;
        padding: 0;
      }
      .container {
        width: 90%;
        max-width: 1400px;
        margin: 40px auto 0 auto;
      }
      .title {
        font-family: "楷体";
        text-align: center;
        font-size: 48px;
        font-weight: bold;
        margin-top: 40px;
        margin-bottom: 40px;
        letter-spacing: 6px;
      }
      .search-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 50px;
        flex-wrap: wrap;
      }
      .search-bar {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
      .search-bar label {
        font-size: 18px;
        margin-right: 8px;
        min-width: 80px;
      }
      .search-bar select,
      .search-bar input[type="text"] {
        font-size: 16px;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        min-width: 230px;
        margin-right: 30px;
      }
      .search-actions {
        display: flex;
        gap: 20px;
      }
      .search-actions button {
        font-size: 18px;
        padding: 8px 32px;
        border: none;
        border-radius: 6px;
        background: #04a0f4;
        color: #fff;
        cursor: pointer;
        transition: background 0.2s;
      }
      .search-actions button:last-child {
        background: #888;
      }
      .search-actions button:hover {
        opacity: 0.9;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 40px;
        background: #fff;
      }
      th,
      td {
        border: 1px solid #b3d7ea;
        padding: 12px 8px;
        text-align: center;
        font-size: 16px;
      }
      th {
        background: #8fd0f6;
        color: #222;
        font-size: 18px;
      }
      tr:nth-child(even) {
        background: #f7fbfd;
      }
      .clear {
        background: #888;
      }
      .empty-message {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 16px;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #04a0f4;
        font-size: 16px;
      }
      .error {
        text-align: center;
        padding: 40px;
        color: #ff4444;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container" id="app">
      <div class="title">课程信息管理系统</div>
      <form class="search-bar">
        <label for="subject">课程学科:</label>
        <select id="subject" v-model="searchParams.subject">
          <option value="">请选择</option>
          <option value="1">AI智能应用开发(Java)</option>
          <option value="2">AI大模型开发(Python)</option>
          <option value="3">AI鸿蒙开发</option>
          <option value="4">AI大数据</option>
          <option value="5">AI嵌入式</option>
          <option value="6">AI测试</option>
          <option value="7">AI运维</option>
        </select>

        <label for="courseName">课程名称:</label>
        <input
          type="text"
          id="courseName"
          placeholder="请输入课程名称"
          v-model="searchParams.name"
        />

        <label for="target">适用人群:</label>
        <select id="target" v-model="searchParams.target">
          <option value="">请选择</option>
          <option value="1">小白学员</option>
          <option value="2">初级程序员</option>
          <option value="3">中级程序员</option>
        </select>

        <div class="search-actions">
          <button type="button" class="query" @click="handleQuery">查询</button>
          <button type="button" class="clear" @click="handleClear">清空</button>
        </div>
      </form>

      <table>
        <thead>
          <tr>
            <th>序号</th>
            <th>课程学科</th>
            <th>课程名称</th>
            <th>价格(元)</th>
            <th>适用人群</th>
            <th>课程介绍</th>
            <th>更新时间</th>
          </tr>
        </thead>
        <tbody>
          <tr v-if="loading">
            <td colspan="7" class="loading">正在加载数据...</td>
          </tr>
          <tr v-else-if="error">
            <td colspan="7" class="error">{{ error }}</td>
          </tr>
          <tr v-else-if="courses.length === 0">
            <td colspan="7" class="empty-message">暂无课程数据</td>
          </tr>
          <tr v-else v-for="(course, index) in courses" :key="course.id">
            <td>{{ index + 1 }}</td>
            <td>{{ subjectMap[course.subject] }}</td>
            <td>{{ course.name }}</td>
            <td>{{ course.price }}</td>
            <td>{{ targetMap[course.target] }}</td>
            <td>{{ course.description }}</td>
            <td>{{ formatDate(course.updateTime) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- js -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="module">
      import { createApp } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
      createApp({
        data() {
          return {
            courses: [],
            searchParams: {
              subject: "",
              name: "",
              target: "",
            },
            loading: false,
            error: "",
            subjectMap: {
              1: "AI智能应用开发(Java)",
              2: "AI大模型开发(Python)",
              3: "AI鸿蒙开发",
              4: "AI大数据",
              5: "AI嵌入式",
              6: "AI测试",
              7: "AI运维",
            },
            targetMap: {
              1: "小白学员",
              2: "初级程序员",
              3: "中级程序员",
            },
          };
        },
        methods: {
          fetchCourses() {
            this.loading = true;
            this.error = "";

            // 构建查询参数
            const params = {};
            if (this.searchParams.subject) {
              params.subject = this.searchParams.subject;
            }
            if (this.searchParams.name) {
              params.name = this.searchParams.name;
            }
            if (this.searchParams.target) {
              params.target = this.searchParams.target;
            }

            // 发送请求
            axios
              .get("http://47.98.197.202:9087/courses/list", { params })
              .then((response) => {
                if (response.data.code === 1) {
                  this.courses = response.data.data || [];
                } else {
                  this.error = "获取课程数据失败: " + response.data.msg;
                  this.courses = [];
                }
              })
              .catch((error) => {
                this.error = "获取课程数据失败，请稍后重试";
                console.error("API请求错误:", error);
                this.courses = [];
              })
              .finally(() => {
                this.loading = false;
              });
          },

          handleQuery() {
            this.fetchCourses();
          },

          handleClear() {
            this.searchParams = {
              subject: "",
              name: "",
              target: "",
            };
            this.fetchCourses(); // 清空后重新加载全部数据
          },

          formatDate(dateString) {
            if (!dateString) return "";
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            const hours = String(date.getHours()).padStart(2, "0");
            const minutes = String(date.getMinutes()).padStart(2, "0");
            const seconds = String(date.getSeconds()).padStart(2, "0");
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
          },
        },
        mounted() {
          // 页面加载完成后自动获取一次数据
          this.fetchCourses();
        },
      }).mount("#app");
    </script>
  </body>
</html>
